<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è„‘å’ä¸­æ‚£è€…æ™ºæ…§ç®¡ç†å¹³å°â€”â€”æ€»è§ˆä¸æ‚£è€…ç®¡ç†</title>
  <!-- TailwindCSS CDN for rapid, modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js for simple charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Utilities not covered by Tailwind */
    .scrollbar-thin::-webkit-scrollbar { height: 6px; width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 9999px; }
    .badge { @apply inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium; }
    .card { @apply bg-white rounded-2xl shadow-sm ring-1 ring-slate-200; }
    .btn { @apply inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium ring-1 ring-inset; }
    .btn-primary { @apply bg-indigo-600 text-white ring-indigo-600 hover:bg-indigo-500; }
    .btn-soft { @apply bg-slate-50 text-slate-700 ring-slate-200 hover:bg-slate-100; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .progress { @apply w-full h-2 rounded-full bg-slate-100 overflow-hidden; }
    .progress-bar { @apply h-2; }
    .mask-gradient { mask-image: linear-gradient(90deg, transparent, black 24px, black calc(100% - 24px), transparent); }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <!-- App Shell -->
  <div class="mx-auto max-w-[1280px] px-4 py-6">
    <!-- Header -->
    <header class="mb-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-indigo-600 text-white grid place-items-center font-bold">NS</div>
        <h1 class="text-xl md:text-2xl font-semibold">è„‘å’ä¸­æ‚£è€…æ™ºæ…§ç®¡ç†å¹³å°â€”â€”æ€»è§ˆä¸æ‚£è€…ç®¡ç†</h1>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn btn-soft" id="btnToOverview">æ€»è§ˆ</button>
        <button class="btn btn-primary" id="btnToPatients">æ‚£è€…ç®¡ç†</button>
      </div>
    </header>

    <div class="grid grid-cols-12 gap-6">
      <!-- Left Floating: ä»Šæ—¥é‡ç‚¹å…³æ³¨ -->
      <aside class="col-span-12 lg:col-span-3">
        <div class="card sticky top-4 p-4">
          <div class="flex items-center justify-between mb-3">
            <h2 class="font-semibold">ä»Šæ—¥é‡ç‚¹å…³æ³¨</h2>
            <span class="text-xs text-slate-500">å…± <span id="focusCount">8</span> äºº</span>
          </div>
          <ul id="focusList" class="space-y-2 text-sm"></ul>
          <p class="mt-3 text-xs text-slate-500">å¯ç‚¹å‡»å¤´åƒæˆ–å§“åæŸ¥çœ‹è¯¦æƒ…ã€‚</p>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="col-span-12 lg:col-span-9 space-y-6">
        <!-- 1) æ ¸å¿ƒæ•°æ®æ€»è§ˆæ¿å— -->
        <section class="space-y-4" id="sectionOverview">
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
            <div class="card p-4">
              <div class="text-sm text-slate-500">å½“æ—¥æ´»è·ƒæ‚£è€…</div>
              <div class="mt-2 flex items-end gap-2">
                <div class="text-2xl font-semibold" id="metricActive">â€”</div>
                <div class="text-sm text-slate-500">/ <span id="metricTotal">â€”</span> äºº</div>
              </div>
              <div class="mt-3 flex items-center gap-2 text-xs text-slate-600">
                <span class="status-dot" style="background:#16a34a"></span>åœ¨çº¿
                <span class="status-dot" style="background:#94a3b8"></span>ç¦»çº¿
              </div>
            </div>
            <div class="card p-4">
              <div class="text-sm text-slate-500">æ•´ä½“æ‰“å¡å®Œæˆç‡</div>
              <div class="mt-2 text-2xl font-semibold" id="metricCheckin">â€”</div>
              <div class="mt-3 progress" title="å®Œæˆç‡">
                <div id="progressCheckin" class="progress-bar bg-indigo-500" style="width:0%"></div>
              </div>
            </div>
            <div class="card p-4">
              <div class="text-sm text-slate-500">é¢„è­¦äº‹ä»¶</div>
              <div class="mt-2 flex items-center gap-3">
                <div class="flex items-center gap-1 text-rose-600"><span class="status-dot" style="background:#dc2626"></span><span class="text-xl font-semibold" id="alertRed">â€”</span><span class="text-xs">çº¢</span></div>
                <div class="flex items-center gap-1 text-amber-600"><span class="status-dot" style="background:#d97706"></span><span class="text-xl font-semibold" id="alertYellow">â€”</span><span class="text-xs">é»„</span></div>
              </div>
            </div>
            <div class="card p-4">
              <div class="flex items-center justify-between">
                <div class="text-sm text-slate-500">æœ¬å‘¨åº·å¤è¾¾æ ‡ç‡è¶‹åŠ¿</div>
                <div class="text-xs text-slate-400" id="trendWeek">â€”</div>
              </div>
              <div class="mt-2">
                <canvas id="weeklyChart" height="110"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- 2) æ‚£è€…åˆ—è¡¨ä¸æ‰“å¡çŠ¶æ€æ¿å— -->
        <section class="space-y-3" id="sectionPatients">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">æ‚£è€…åˆ—è¡¨ä¸æ‰“å¡çŠ¶æ€</h2>
            <div class="flex items-center gap-2">
              <input id="searchInput" type="search" placeholder="æœç´¢æ‚£è€…å§“åâ€¦" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              <select id="filterType" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="">å…¨éƒ¨ç±»å‹</option>
                <option>ç¼ºè¡€æ€§è„‘æ¢—</option>
                <option>å‡ºè¡€æ€§è„‘å’ä¸­</option>
              </select>
            </div>
          </div>

          <div class="card overflow-hidden">
            <table class="min-w-full divide-y divide-slate-200">
              <thead class="bg-slate-50 text-left text-xs font-medium text-slate-500">
                <tr>
                  <th class="px-4 py-2">åŸºç¡€ä¿¡æ¯</th>
                  <th class="px-4 py-2">å½“æ—¥æ‰“å¡è¿›åº¦</th>
                  <th class="px-4 py-2">æœ€åæ‰“å¡</th>
                  <th class="px-4 py-2">å¼‚å¸¸æ ‡è¯†</th>
                </tr>
              </thead>
              <tbody id="patientTable" class="divide-y divide-slate-100 bg-white text-sm"></tbody>
            </table>
          </div>
        </section>

        <!-- 3) æ‚£è€…è¯¦æƒ…ä¸è·Ÿè¿›è®°å½•ï¼ˆå•é¡µå†…è·¯ç”±ï¼‰ -->
        <section id="sectionDetail" class="hidden">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h2 id="detailName" class="font-semibold text-lg">æ‚£è€…è¯¦æƒ…</h2>
              <p id="detailSub" class="text-xs text-slate-500">â€”</p>
            </div>
            <button class="btn btn-soft" id="btnBack">â† è¿”å›åˆ—è¡¨</button>
          </div>

          <div class="grid grid-cols-12 gap-6">
            <!-- å·¦ï¼šåº·å¤è®¡åˆ’æ—¥å† -->
            <div class="col-span-12 lg:col-span-5">
              <div class="card p-4">
                <div class="flex items-center justify-between">
                  <h3 class="font-medium">åº·å¤è®¡åˆ’æ—¥å†</h3>
                  <div class="flex items-center gap-2 text-sm">
                    <button class="btn btn-soft" data-view="week">å‘¨è§†å›¾</button>
                    <button class="btn btn-soft" data-view="month">æœˆè§†å›¾</button>
                  </div>
                </div>
                <div class="mt-4 grid grid-cols-7 gap-2 text-center" id="calendarGrid"></div>
                <p class="mt-3 text-xs text-slate-500">å·²å®Œæˆæ ‡ <span class="text-green-600">ç»¿</span> å¹¶æ˜¾ç¤ºå®Œæˆç‡ï¼Œæœªå®Œæˆæ ‡ <span class="text-rose-600">çº¢</span>ã€‚</p>
              </div>
            </div>

            <!-- å³ï¼š10ä¸ªå°é¡¹ -->
            <div class="col-span-12 lg:col-span-7">
              <div class="card divide-y divide-slate-100">
                <details class="group p-4" open>
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">åŠ¨è„‰ç©¿åˆºç‚¹å‹è¿«è§‚å¯Ÿ</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="flex items-center gap-3">
                      <label class="shrink-0">å®æ—¶ç›‘æµ‹å‹è¿«ç‚¹æœ‰æ— æ¸—è¡€æ¸—æ¶²ï¼š</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="bleed" value="å¦" checked> å¦</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="bleed" value="æ˜¯"> æ˜¯</label>
                      <input id="bleedTime" type="datetime-local" class="ml-auto hidden rounded-lg border border-slate-200 px-2 py-1" />
                      <span id="bleedWarn" class="hidden text-rose-600 text-sm">çº¢è‰²é¢„è­¦</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <label class="shrink-0">ç›‘æµ‹å‹è¿«ä¾§è‚¢ä½“çš®è‚¤æ¸©åº¦ï¼š</label>
                      <input id="skinTemp" type="number" step="0.1" placeholder="â„ƒ" class="w-28 rounded-lg border border-slate-200 px-2 py-1" />
                      <span id="tempWarn" class="text-amber-600 hidden">æ¸©åº¦å¼‚å¸¸ï¼Œé¢„è­¦</span>
                    </div>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">ä½é™¢æœŸé—´åº·å¤æ‰“å¡æ˜ç»†</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-5 text-sm">
                    <div class="rounded-xl border border-slate-200 p-3">
                      <div class="flex items-center justify-between">
                        <div class="font-medium"> è¸æ³µè¿åŠ¨_(æ‰“å¡å›¾/å‚ç…§å›¾)</div>
                        <button class="btn btn-soft">æŸ¥çœ‹è§†é¢‘</button>
                      </div>
                      <p class="mt-1 text-slate-600">è¾¾æ ‡ç‡ <b>72%</b>ã€€å¿ƒç‡ <b>77â€“87</b>bpmã€€è¡€å‹ <b>130/80</b>ã€<b>133/82</b>mmHg</p>
                      <div class="mt-2 grid grid-cols-2 gap-3">
                        
<div class="aspect-video rounded-lg bg-slate-100 grid place-items-center text-slate-400">
 
  <img src="https://a1.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEIYvveY*riKqDUvlOVowXF5i9tQ8CZOqsl8tOWATTGjvzmbWhRfmgVffCp6IqrWKskwekXfRJUtYi07o*S3IOOs!/b&ek=1&kp=1&pt=0&bo=4gEkAeIBJAEDFzI!&tl=1&vuin=1786370596&tm=1754899200&dis_t=1754899957&dis_k=47b2e0fd1f8e72e8728299cb08957439&sce=60-4-3&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
 <img src="http://m.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEIYvveY*riKqDUvlOVowXF7q3WhzDikqI2eySq9TE4XREiiAdDM4WSU0kNDZrfzhrO9u.uPlEPoqx.PGtsQlqx0!/b&bo=4gOSAuIDkgIDJwI!&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
                     
                      </div>
                      <div class="mt-3 text-right"><button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button></div>
                    </div>

                    <div class="rounded-xl border border-slate-200 p-3">
                      <div class="flex items-center justify-between">
                        <div class="font-medium">b. å¼¹åŠ›å¸¦ä¸‹è‚¢æŠ—é˜»åŠ›</div>
                        <button class="btn btn-soft">æŸ¥çœ‹è§†é¢‘</button>
                      </div>
                      <p class="mt-1 text-slate-600">è¾¾æ ‡ç‡ <b>75%</b>ã€€å¿ƒç‡ <b>81â€“89</b>bpmã€€è¡€å‹ <b>130/82</b>ã€<b>137/88</b>mmHg</p>
                      <div class="mt-2 grid grid-cols-2 gap-3">
<div class="aspect-video rounded-lg bg-slate-100 grid place-items-center text-slate-400">
 <img src="http://m.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEIYvveY*riKqDUvlOVowXF4OaKPWFPgCJbTUgp1tJHQ3z4TL69F5UYF9z0Dd.Tqg4*quqa9*0zZlPAOp5tzkaQg!/b&bo=aAHMAGgBzAADFzI!&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
 <img src="http://m.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEIYvveY*riKqDUvlOVowXF4d*uHIfFOBoFGbUvAl6wNxVoeLA5usOzvgEJ6fWQI7O39OwH3Gd3WKZQEslGOK6Q4!/b&bo=YQFoAWEBaAEDJwI!&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
                        
                      </div>
                      <div class="mt-3 text-right"><button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button></div>
                    </div>

                    <div class="rounded-xl border border-slate-200 p-3">
                      <div class="flex items-center justify-between">
                        <div class="font-medium">c. è…¹å¼å‘¼å¸é”»ç‚¼å°å“¨ç¬›</div>
                        <button class="btn btn-soft">æŸ¥çœ‹è§†é¢‘</button>
                      </div>
                      <p class="mt-1 text-slate-600">è¾¾æ ‡ç‡ <b>82%</b>ã€€å¿ƒç‡ <b>75â€“83</b>bpmã€€è¡€å‹ <b>133/80</b>ã€<b>134/82</b>mmHg</p>
                      <div class="mt-2 grid grid-cols-2 gap-3">
                      
<div class="aspect-video rounded-lg bg-slate-100 grid place-items-center text-slate-400">
 <img src="http://m.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEDjvVzsNMt2kl4pP5WlnqtZOeKaZD5dtu9bh4CUmpigzvBWCfmxO*Jow21oAoY8naPcXho2XJKdS9U975JLU5tE!/b&bo=ngTEB54ExAcDZ0I!&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
 <img src="http://m.qpic.cn/psc?/V51OqGKy0C9hxg3Yv4EQ0aKAt03GgKbI/TmEUgtj9EK6.7V8ajmQrEDjvVzsNMt2kl4pP5WlnqtYZ4mvh37HyhHMIZLU.2nlz3syHEaSqe*TM9R*Np58jOUjkAnfm7cYKE7rriCiB*pA!/b&bo=8QA2AfEANgEDFzI!&rf=viewer_4" alt="å…³é”®å¸§ç¤ºæ„å›¾" class="w-full h-full object-cover rounded-lg">
</div>
                      </div>
                      <div class="mt-3 text-right"><button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button></div>
                    </div>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">å‡ºé™¢æ‰“å¡åº·å¤æ˜ç»†</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-4 text-sm">
                    <div class="flex items-center gap-3">
                      <span>æ˜¯å¦æ¯æ—¥é”»ç‚¼ï¼š</span>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="trainDaily" value="æ˜¯" checked> æ˜¯</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="trainDaily" value="å¦"> å¦</label>
                      <img id="trainSuggestImg" src="https://placehold.co/220x120?text=%E5%BB%BA%E8%AE%AE%E9%94%80%E7%BB%83" class="hidden ml-3 rounded-lg ring-1 ring-slate-200" alt="å»ºè®®é”»ç‚¼" />
                    </div>
                    <div class="flex items-center gap-3">
                      <label>é”»ç‚¼æ—¶é•¿ï¼š</label>
                      <input type="number" min="5" step="5" value="20" class="w-20 rounded-lg border border-slate-200 px-2 py-1"> åˆ†é’Ÿ
                      <label class="ml-4">æ—¶é—´ï¼š</label>
                      <select class="rounded-lg border border-slate-200 px-2 py-1">
                        <option>ä¸Šåˆ</option>
                        <option selected>ä¸‹åˆ</option>
                        <option>æ™šä¸Š</option>
                      </select>
                    </div>

                    <div class="grid gap-3">
                      <div class="rounded-xl border border-slate-200 p-3 flex items-center justify-between">
                        <div>è¸æ³µè¿åŠ¨</div>
                        <div class="flex items-center gap-2">
                          <label class="btn btn-soft cursor-pointer">ä¸Šä¼ è§†é¢‘/æ‹ç…§ä¸Šä¼ <input type="file" accept="video/*,image/*" class="hidden"></label>
                          <button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button>
                        </div>
                      </div>
                      <div class="rounded-xl border border-slate-200 p-3 flex items-center justify-between">
                        <div>å¼¹åŠ›å¸¦ä¸‹è‚¢æŠ—é˜»åŠ›è®­ç»ƒ</div>
                        <div class="flex items-center gap-2">
                          <label class="btn btn-soft cursor-pointer">ä¸Šä¼ è§†é¢‘/æ‹ç…§ä¸Šä¼ <input type="file" accept="video/*,image/*" class="hidden"></label>
                          <button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button>
                        </div>
                      </div>
                      <div class="rounded-xl border border-slate-200 p-3 flex items-center justify-between">
                        <div>è…¹å¼å‘¼å¸é”»ç‚¼å°å“¨ç¬›</div>
                        <div class="flex items-center gap-2">
                          <label class="btn btn-soft cursor-pointer">ä¸Šä¼ è§†é¢‘/æ‹ç…§ä¸Šä¼ <input type="file" accept="video/*,image/*" class="hidden"></label>
                          <button class="btn btn-primary">AIæ™ºèƒ½åˆ†æ</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">åº·å¤è¯„ä¼°</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="grid grid-cols-1 gap-3">
                      <div class="card p-3">
                        <canvas id="radarChart" height="160"></canvas>
                      </div>
                    </div>
                    <div class="flex items-center gap-2">
                      <label>çº¿ä¸‹è¯„ä¼°(æœˆåº¦)ï¼š</label>
                      <input type="month" class="rounded-lg border border-slate-200 px-2 py-1" />
                      <input type="number" placeholder="ç»¼åˆè¯„åˆ†(0-100)" class="rounded-lg border border-slate-200 px-2 py-1" />
                      <button class="btn btn-soft">è®°å½•</button>
                    </div>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">ç”Ÿå‘½ä½“å¾ç›‘æµ‹</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="flex items-center gap-3">
                      <span>æ˜¯å¦æµ‹é‡ï¼š</span>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="vital" value="æ˜¯" checked> æ˜¯</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="vital" value="å¦"> å¦</label>
                      <img id="vitalSuggestImg" src="https://placehold.co/220x120?text=%E5%BB%BA%E8%AE%AE%E7%9B%91%E6%B5%8B%E7%94%9F%E5%91%BD%E4%BD%93%E5%BE%81" class="hidden ml-3 rounded-lg ring-1 ring-slate-200" alt="å»ºè®®ç›‘æµ‹ç”Ÿå‘½ä½“å¾" />
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                      <label class="flex items-center gap-2">å‘¼å¸ <input id="resp" type="number" class="w-24 rounded-lg border border-slate-200 px-2 py-1"> æ¬¡/åˆ†</label>
                      <label class="flex items-center gap-2">è„‰æ <input id="pulse" type="number" class="w-24 rounded-lg border border-slate-200 px-2 py-1"> æ¬¡/åˆ†</label>
                      <label class="flex items-center gap-2">è¡€å‹ <input id="sbp" type="number" class="w-24 rounded-lg border border-slate-200 px-2 py-1" placeholder="æ”¶ç¼©å‹"> / <input id="dbp" type="number" class="w-24 rounded-lg border border-slate-200 px-2 py-1" placeholder="èˆ’å¼ å‹"> mmHg</label>
                    </div>
                    <div class="card p-3">
                      <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-slate-500">ç”Ÿå‘½ä½“å¾è¶‹åŠ¿</div>
                        <div class="flex items-center gap-2 text-xs">
                          <button class="btn btn-soft vital-range" data-range="day">æ—¥</button>
                          <button class="btn btn-soft vital-range" data-range="week">å‘¨</button>
                          <button class="btn btn-soft vital-range" data-range="month">æœˆ</button>
                        </div>
                      </div>
                      <canvas id="vitalChart" height="140"></canvas>
                    </div>
                    <div class="text-right"><button class="btn btn-primary" id="btnVitalAI">AIæ™ºèƒ½åˆ†æ</button></div>
                    <p id="vitalAIResult" class="hidden text-sm"></p>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">ç”¨è¯æƒ…å†µ</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="flex items-center gap-3">
                      <span>æ˜¯å¦æŒ‰æ—¶æœè¯ï¼š</span>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="med" value="æ˜¯" checked> æ˜¯</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="med" value="å¦"> å¦</label>
                      <img id="medSuggestImg" src="https://placehold.co/220x120?text=%E6%8F%90%E7%A4%BA%E6%8C%89%E6%97%B6%E6%9C%8D%E8%8D%AF" class="hidden ml-3 rounded-lg ring-1 ring-slate-200" alt="å»ºè®®æŒ‰æ—¶æœè¯" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <label class="flex items-center gap-2">æ—¥æœŸæ—¶é—´ <input type="datetime-local" class="rounded-lg border border-slate-200 px-2 py-1" value="2025-08-08T18:00" /></label>
                      <label class="flex items-center gap-2">ç”¨è¯åç§° <input type="text" class="rounded-lg border border-slate-200 px-2 py-1" value="å„è´æ²™å¦" /></label>
                      <label class="flex items-center gap-2">ç”¨è¯é‡ <select class="rounded-lg border border-slate-200 px-2 py-1"><option>ä¸€é¢—</option><option>ä¸¤é¢—</option></select></label>
                    </div>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">ç¡çœ æƒ…å†µ</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-center">
                      <label class="flex items-center gap-2">æ—¥æœŸ <input type="date" class="rounded-lg border border-slate-200 px-2 py-1"></label>
                      <label class="flex items-center gap-2">ç¡çœ æ—¶é•¿ <input id="sleepHour" type="number" step="0.5" value="7.5" class="w-24 rounded-lg border border-slate-200 px-2 py-1"> å°æ—¶</label>
                      <button class="btn btn-soft">è®°å½•</button>
                    </div>
                    <div class="card p-3">
                      <div class="flex items-center justify-between mb-2"><div class="text-sm text-slate-500">ç¡çœ è¶‹åŠ¿</div>
                        <div class="flex items-center gap-2 text-xs">
                          <button class="btn btn-soft sleep-range" data-range="day">æ—¥</button>
                          <button class="btn btn-soft sleep-range" data-range="week">å‘¨</button>
                          <button class="btn btn-soft sleep-range" data-range="month">æœˆ</button>
                        </div>
                      </div>
                      <canvas id="sleepChart" height="140"></canvas>
                    </div>
                    <div class="text-right"><button class="btn btn-primary" id="btnSleepAI">AIæ™ºèƒ½åˆ†æ</button></div>
                    <p id="sleepAIResult" class="hidden text-sm"></p>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">é¥®é£Ÿæƒ…å†µ</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="flex items-center gap-3">
                      <span>æ˜¯å¦æŒ‰æ—¶åƒé¥­ï¼š</span>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="diet" value="æ˜¯" checked> æ˜¯</label>
                      <label class="inline-flex items-center gap-1"><input type="radio" name="diet" value="å¦"> å¦</label>
                      <img id="dietSuggestImg" src="https://placehold.co/220x120?text=%E5%BB%BA%E8%AE%AE%E6%8C%89%E6%97%B6%E9%A5%AE%E9%A3%9F" class="hidden ml-3 rounded-lg ring-1 ring-slate-200" alt="å»ºè®®æŒ‰æ—¶åƒé¥­" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                      <label class="flex items-center gap-2">æ—©é¤ <input type="text" class="rounded-lg border border-slate-200 px-2 py-1" placeholder="ç¤ºä¾‹ï¼šç‡•éº¦ç‰›å¥¶"></label>
                      <label class="flex items-center gap-2">ä¸­é¤ <input type="text" class="rounded-lg border border-slate-200 px-2 py-1" placeholder="ç¤ºä¾‹ï¼šæ¸…è’¸é±¼+è”¬èœ"></label>
                      <label class="flex items-center gap-2">æ™šé¤ <input type="text" class="rounded-lg border border-slate-200 px-2 py-1" placeholder="ç¤ºä¾‹ï¼šæ‚ç²®é¥­"></label>
                    </div>
                    <div class="text-right"><button class="btn btn-primary" id="btnDietAI">AIæ™ºèƒ½åˆ†æ</button></div>
                    <p id="dietAIResult" class="hidden text-sm"></p>
                  </div>
                </details>

                <details class="group p-4">
                  <summary class="flex cursor-pointer items-center justify-between">
                    <span class="font-medium">éšè®¿è®°å½•</span>
                    <span class="text-xs text-slate-400 group-open:rotate-180 transition">âŒƒ</span>
                  </summary>
                  <div class="mt-3 space-y-3 text-sm">
                    <div class="flex items-center gap-2">
                      <input id="followTime" type="time" class="rounded-lg border border-slate-200 px-2 py-1" value="14:30">
                      <input id="followText" type="text" class="flex-1 rounded-lg border border-slate-200 px-3 py-2" placeholder="è¾“å…¥éšè®¿è®°å½•ï¼Œå¦‚ï¼šç”µè¯éšè®¿ï¼Œå³ä¾§è‚©ç—›ï¼Œå·²è°ƒæ•´æ˜æ—¥è®­ç»ƒå¼ºåº¦â€¦">
                      <label class="btn btn-soft cursor-pointer">ä¸Šä¼ è¯­éŸ³<input type="file" accept="audio/*" class="hidden"></label>
                      <label class="btn btn-soft cursor-pointer">ä¸Šä¼ ç…§ç‰‡<input type="file" accept="image/*" class="hidden"></label>
                      <button class="btn btn-primary" id="btnAddFollow">æ·»åŠ </button>
                    </div>
                    <div class="card p-3 max-h-48 overflow-auto scrollbar-thin" id="followList"></div>
                  </div>
                </details>

              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- å¤´åƒç‚¹å‡»ï¼šå‘ç—…è¯¦æƒ…å¼¹çª— -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 p-4">
    <div class="card w-full max-w-lg p-4">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">å‘ç—…è¯¦æƒ…</h3>
        <button class="btn btn-soft" id="modalClose">å…³é—­</button>
      </div>
      <div id="modalBody" class="mt-3 text-sm space-y-2"></div>
    </div>
  </div>

  <script>
    // ======= Mock æ•°æ® =======
    const patients = [
      {id:1, name:'å¼ å»ºå›½', age:62, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://img1.baidu.com/it/u=2317818478,3940283167&fm=253&app=138&f=JPEG?w=800&h=1458', last:'10:23',
        progress:{morning:true, noon:true, night:true, inProgress:null},
        exceptions:['ğŸ’“'], lesion:'å·¦ä¾§å¤§è„‘ä¸­åŠ¨è„‰åŒº', muscle:'ä¸Šè‚¢4çº§ ä¸‹è‚¢4çº§',
        focusTag:'è¿ç»­2å¤©æœªæ‰“å¡'},
      {id:2, name:'ææ¢…', age:58, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://img1.baidu.com/it/u=1314308307,914014156&fm=253&fmt=auto&app=138&f=JPEG?w=570&h=380', last:'09:12',
        progress:{morning:true, noon:false, night:false, inProgress:'ä¸‹åˆ(3/5)'}, exceptions:['âš ï¸'], lesion:'å³ä¾§å°è„‘åŠçƒ', muscle:'ä¸Šè‚¢3çº§ ä¸‹è‚¢4çº§', focusTag:'è¿ç»­2å¤©æœªæ‰“å¡'},
      {id:3, name:'ç‹å¼º', age:65, type:'å‡ºè¡€æ€§è„‘å’ä¸­', avatar:'https://bpic.wotucdn.com//original/33/74/62/33746212-33ea7b264773faa40107a024ba2fd2a5.png!/quality/91/unsharp/true/compress/true/watermark/url/bG9nby53YXRlci52OC5wbmc=/align/center/rotate/auto/fw/320', last:'â€”',
        progress:{morning:false, noon:false, night:false, inProgress:null}, exceptions:['ğŸ“Š'], lesion:'åŸºåº•èŠ‚åŒºå‡ºè¡€', muscle:'ä¸Šè‚¢3çº§ ä¸‹è‚¢3çº§', focusTag:'è¿ç»­2å¤©æœªæ‰“å¡'},
      {id:4, name:'èµµä»£ç§€', age:60, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://bpic.wotucdn.com//original/33/74/60/33746051-5883a3811418ed70145f895f7ddbe787.png!/quality/91/unsharp/true/compress/true/watermark/url/bG9nby53YXRlci52OC5wbmc=/align/center/rotate/auto/fw/320', last:'08:05',
        progress:{morning:true, noon:true, night:false, inProgress:null}, exceptions:[], lesion:'è„‘å¹²', muscle:'ä¸Šè‚¢5çº§ ä¸‹è‚¢4çº§', focusTag:'è¿ç»­2å¤©æœªæ‰“å¡'},
      {id:5, name:'é™ˆä¸­å', age:55, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://randomuser.me/api/portraits/men/15.jpg', last:'â€”',
        progress:{morning:false, noon:false, night:false, inProgress:null}, exceptions:['âš ï¸','ğŸ“Š'], lesion:'é¡¶å¶çš®å±‚', muscle:'ä¸Šè‚¢4çº§ ä¸‹è‚¢3çº§', focusTag:'è¿ç»­2å¤©æœªæ‰“å¡'},
      {id:6, name:'åˆ˜æ•èŠ³', age:52, type:'å‡ºè¡€æ€§è„‘å’ä¸­', avatar:'https://img2.baidu.com/it/u=1185840822,2159383008&fm=253&fmt=auto&app=138&f=JPEG?w=570&h=380', last:'11:20',
        progress:{morning:true, noon:true, night:true, inProgress:null}, exceptions:[], lesion:'é¢å¶çš®å±‚', muscle:'ä¸Šè‚¢5çº§ ä¸‹è‚¢5çº§', focusTag:'è¾¾æ ‡ç‡éª¤é™'},
      {id:7, name:'å‘¨å‹‡', age:67, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://img2.baidu.com/it/u=4183070901,847061650&fm=253&app=138&f=JPEG?w=800&h=1422', last:'07:50',
        progress:{morning:true, noon:true, night:true, inProgress:null}, exceptions:['ğŸ’“'], lesion:'ä¸˜è„‘', muscle:'ä¸Šè‚¢4çº§ ä¸‹è‚¢4çº§', focusTag:'æ¯æ—¥æ‰“å¡'},
      {id:8, name:'å­™å¾·èŠ±', age:59, type:'ç¼ºè¡€æ€§è„‘æ¢—', avatar:'https://img1.baidu.com/it/u=3292755124,2188512369&fm=253&app=138&f=JPEG?w=800&h=1422g', last:'â€”',
        progress:{morning:false, noon:false, night:false, inProgress:null}, exceptions:['ğŸ“Š'], lesion:'æ•å¶çš®å±‚', muscle:'ä¸Šè‚¢3çº§ ä¸‹è‚¢3çº§', focusTag:'ä¸€å¤©æœªæ‰“å¡'},
    ];

    // æ ¸å¿ƒæŒ‡æ ‡
    const metrics = { active: 86, total: 120, checkin: 78, alerts:{red:3, yellow:5}, week:['å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­','å‘¨æ—¥'], values:[62,70,68,75,78,80,79] };

    // ======= åˆå§‹åŒ–æ¸²æŸ“ =======
    const el = (sel)=>document.querySelector(sel);
    const elAll = (sel)=>Array.from(document.querySelectorAll(sel));

    function renderDashboard(){
      el('#metricActive').textContent = metrics.active;
      el('#metricTotal').textContent = metrics.total;
      el('#metricCheckin').textContent = metrics.checkin + '%';
      el('#progressCheckin').style.width = metrics.checkin + '%';
      el('#alertRed').textContent = metrics.alerts.red;
      el('#alertYellow').textContent = metrics.alerts.yellow;
      el('#trendWeek').textContent = 'æœ¬å‘¨';

      const ctx = document.getElementById('weeklyChart');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: metrics.week,
          datasets: [{
            label: 'è¾¾æ ‡ç‡(%)', data: metrics.values, tension: 0.35, fill: false,
            borderWidth: 2, pointRadius: 3
          }]
        },
        options: { responsive: true, plugins:{legend:{display:false}}, scales:{ y:{ suggestedMin: 40, suggestedMax: 100 } } }
      });
    }

    function progressBarHTML(p){
      // Build a compact colored strip: green for done, amber for inProgress, red for not started
      const seg = (color, w)=>`<div class="h-2 ${color}" style="width:${w}%"></div>`;
      const total = 3; // morning noon night
      const done = (p.morning?1:0) + (p.noon?1:0) + (p.night?1:0);
      const inProg = p.inProgress?1:0;
      const none = Math.max(total - done - inProg, 0);
      let html = '<div class="progress flex">';
      if(done>0) html += seg('bg-green-500', done/total*100);
      if(inProg>0) html += seg('bg-amber-400', inProg/total*100);
      if(none>0) html += seg('bg-rose-400', none/total*100);
      html += '</div>';
      const labels = [];
      if(p.morning) labels.push('ä¸Šåˆè®­ç»ƒâˆš'); else if(!p.inProgress) labels.push('ä¸Šåˆæœªå¼€å§‹');
      if(p.noon===true) labels.push('ä¸‹åˆè®­ç»ƒâˆš');
      if(p.night===true) labels.push('æ™šä¸Šè®­ç»ƒâˆš');
      if(p.inProgress) labels.push(`${p.inProgress} ä¸­`);
      return `${html}<div class="mt-1 text-xs text-slate-500">${labels.join('ã€€')}</div>`;
    }

    function renderTable(filterName='', filterType=''){
      const tbody = el('#patientTable');
      tbody.innerHTML = '';
      patients
        .filter(p=>p.name.includes(filterName))
        .filter(p=>!filterType || p.type===filterType)
        .forEach(p=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="px-4 py-3">
              <div class="flex items-center gap-3">
                <img src="${p.avatar}" alt="${p.name}" class="h-10 w-10 rounded-full ring-2 ring-white shadow cursor-pointer" data-avatar="${p.id}">
                <div>
                  <div class="font-medium text-slate-800 hover:text-indigo-600 cursor-pointer" data-detail="${p.id}">${p.name}</div>
                  <div class="text-xs text-slate-500">${p.age} å²ã€€<span class="badge bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200">${p.type}</span></div>
                </div>
              </div>
            </td>
            <td class="px-4 py-3">${progressBarHTML(p.progress)}</td>
            <td class="px-4 py-3 text-slate-600">${p.last}</td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2 text-lg">${p.exceptions.map(e=>`<span title="å¼‚å¸¸">${e}</span>`).join('')}</div>
            </td>`;
          tbody.appendChild(tr);
        });

      // Bind avatar -> modal
      elAll('[data-avatar]').forEach(img=>{
        img.addEventListener('click', e=>{
          const id = Number(e.currentTarget.getAttribute('data-avatar'));
          const p = patients.find(x=>x.id===id);
          openModal(`<div class='space-y-1'>
            <div><b>å§“åï¼š</b>${p.name}</div>
            <div><b>ç—…ç¶ä½ç½®ï¼š</b>${p.lesion}</div>
            <div><b>è‚ŒåŠ›ç­‰çº§ï¼š</b>${p.muscle}</div>
            <div><b>å’ä¸­ç±»å‹ï¼š</b>${p.type}</div>
          </div>`);
        })
      });

      // Bind name -> detail
      elAll('[data-detail]').forEach(a=>{
        a.addEventListener('click', e=>{
          const id = Number(e.currentTarget.getAttribute('data-detail'));
          openDetail(id);
        })
      });
    }

    function renderFocus(){
      const list = el('#focusList');
      list.innerHTML = '';
      // å‰5ï¼šè¿ç»­2å¤©æœªæ‰“å¡ï¼›å3ï¼šè¾¾æ ‡ç‡éª¤é™/æ¯æ—¥æ‰“å¡/ä¸€å¤©æœªæ‰“å¡
      const sorted = [
        ...patients.filter(p=>p.focusTag==='è¿ç»­2å¤©æœªæ‰“å¡'),
        ...patients.filter(p=>p.focusTag!=='è¿ç»­2å¤©æœªæ‰“å¡')
      ].slice(0,8);
      sorted.forEach(p=>{
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="flex items-center gap-3 rounded-xl p-2 hover:bg-slate-50">
            <img src="${p.avatar}" class="h-9 w-9 rounded-full ring-1 ring-slate-200 cursor-pointer" data-avatar="${p.id}" alt="${p.name}">
            <div class="min-w-0 flex-1">
              <div class="flex items-center justify-between">
                <a class="truncate hover:text-indigo-600 cursor-pointer" data-detail="${p.id}">${p.name}</a>
                <span class="text-xs text-slate-500">${p.last||'â€”'}</span>
              </div>
              <div class="text-xs text-amber-600">${p.focusTag}</div>
            </div>
          </div>`;
        list.appendChild(li);
      });
      el('#focusCount').textContent = 8;

      // rebind events
      elAll('[data-detail]').forEach(a=>a.addEventListener('click', e=>{
        const id = Number(e.currentTarget.getAttribute('data-detail'));
        openDetail(id);
      }));
      elAll('[data-avatar]').forEach(img=>img.addEventListener('click', e=>{
        const id = Number(e.currentTarget.getAttribute('data-avatar'));
        const p = patients.find(x=>x.id===id);
        openModal(`<div class='space-y-1'>
          <div><b>å§“åï¼š</b>${p.name}</div>
          <div><b>ç—…ç¶ä½ç½®ï¼š</b>${p.lesion}</div>
          <div><b>è‚ŒåŠ›ç­‰çº§ï¼š</b>${p.muscle}</div>
          <div><b>å’ä¸­ç±»å‹ï¼š</b>${p.type}</div>
        </div>`);
      }));
    }

    // ======= è¯¦æƒ…é¡µ =======
    function openDetail(id){
      const p = patients.find(x=>x.id===id);
      if(!p) return;
      // header
      el('#detailName').textContent = `${p.name}ï¼ˆ${p.age}å²ï¼‰`;
      el('#detailSub').textContent = `${p.type} Â· ç—…ç¶ï¼š${p.lesion} Â· è‚ŒåŠ›ï¼š${p.muscle}`;

      // calendar mock (å…¥é™¢ç¬¬1å¤©â€¦)
      renderCalendar('week');

      // show section
      el('#sectionOverview').classList.add('hidden');
      el('#sectionPatients').classList.add('hidden');
      el('#sectionDetail').classList.remove('hidden');
      window.scrollTo({top:0,behavior:'smooth'});

      // Radar chart
      const radar = document.getElementById('radarChart');
      if(radar._chart) radar._chart.destroy();
      radar._chart = new Chart(radar, {
        type: 'radar',
        data: { labels:['è‚¢ä½“åŠŸèƒ½','è¨€è¯­èƒ½åŠ›','å¹³è¡¡åè°ƒ','æ—¥å¸¸ç”Ÿæ´»','è®°å¿†æ³¨æ„','æƒ…ç»ªçŠ¶æ€'], datasets:[{ data:[65, 58, 62, 70, 55, 60], borderWidth:2, pointRadius:2 }]},
        options: { plugins:{legend:{display:false}}, scales:{ r:{ suggestedMin:0, suggestedMax:100 }}}
      });

      // Vital chart
      const vital = document.getElementById('vitalChart');
      if(vital._chart) vital._chart.destroy();
      vital._chart = new Chart(vital, {
        type: 'line',
        data: { labels: Array.from({length:7}, (_,i)=>`D${i+1}`), datasets:[{label:'å¿ƒç‡', data:[80,84,82,88,90,86,85], borderWidth:2, pointRadius:2},{label:'å‘¼å¸', data:[18,19,18,20,19,18,17], borderWidth:2, pointRadius:2}]},
        options: { plugins:{legend:{position:'bottom'}}, scales:{ y:{ beginAtZero:false }}}
      });

      // Sleep chart
      const sleep = document.getElementById('sleepChart');
      if(sleep._chart) sleep._chart.destroy();
      sleep._chart = new Chart(sleep, {
        type: 'line',
        data: { labels: Array.from({length:7}, (_,i)=>`D${i+1}`), datasets:[{label:'ç¡çœ æ—¶é•¿(h)', data:[7.5,6.0,6.5,7.0,8.0,7.2,7.6], borderWidth:2, pointRadius:2}]},
        options: { plugins:{legend:{position:'bottom'}}, scales:{ y:{ suggestedMin:4, suggestedMax:10 }}}
      });

      // bind toggles
      elAll('[data-view]').forEach(btn=>btn.onclick=(e)=>{
        renderCalendar(e.currentTarget.getAttribute('data-view'))
      });
    }

    function renderCalendar(view){
      const grid = el('#calendarGrid');
      grid.innerHTML = '';
      const count = view==='week'?7:28;
      for(let i=1;i<=count;i++){
        const finished = Math.random()>0.3;
        const rate = Math.floor(60 + Math.random()*40);
        const cell = document.createElement('div');
        cell.className = `rounded-xl p-2 border text-xs ${finished? 'border-green-200 bg-green-50 text-green-700':'border-rose-200 bg-rose-50 text-rose-700'}`;
        cell.innerHTML = `<div class="font-medium">å…¥é™¢ç¬¬${i}å¤©</div><div>${finished?`å®Œæˆç‡ ${rate}%`:'æœªå®Œæˆ'}</div>`;
        grid.appendChild(cell);
      }
    }

    // Vital & Sleep range buttons
    elAll('.vital-range').forEach(b=>b.addEventListener('click', ()=>{
      const vital = document.getElementById('vitalChart');
      const len = b.dataset.range==='day'? 24 : (b.dataset.range==='week'? 7 : 30);
      vital._chart.data.labels = Array.from({length:len}, (_,i)=> (b.dataset.range==='day'? `${i}:00` : `D${i+1}`));
      vital._chart.data.datasets[0].data = Array.from({length:len}, ()=> 75+Math.round(Math.random()*20));
      vital._chart.data.datasets[1].data = Array.from({length:len}, ()=> 16+Math.round(Math.random()*6));
      vital._chart.update();
    }));
    elAll('.sleep-range').forEach(b=>b.addEventListener('click', ()=>{
      const sleep = document.getElementById('sleepChart');
      const len = b.dataset.range==='day'? 24 : (b.dataset.range==='week'? 7 : 30);
      sleep._chart.data.labels = Array.from({length:len}, (_,i)=> (b.dataset.range==='day'? `${i}:00` : `D${i+1}`));
      sleep._chart.data.datasets[0].data = Array.from({length:len}, ()=> (6 + Math.random()*3).toFixed(1));
      sleep._chart.update();
    }));

    // AI åˆ†ææŒ‰é’®ï¼ˆä¼ªç¤ºä¾‹ï¼‰
    el('#btnVitalAI').addEventListener('click', ()=>{
      const bpm = document.getElementById('pulse').value || 82;
      const sbp = document.getElementById('sbp').value || 130;
      const dbp = document.getElementById('dbp').value || 82;
      const risk = (bpm>100 || sbp>140 || dbp>90);
      const p = el('#vitalAIResult');
      p.classList.remove('hidden');
      p.innerHTML = risk ? '<span class="text-rose-600">AIæç¤ºï¼šå¿ƒç‡/è¡€å‹å¯èƒ½åé«˜ï¼Œå»ºè®®å‡é‡è®­ç»ƒå¹¶å¤æµ‹ã€‚</span>' : '<span class="text-green-600">AIæç¤ºï¼šç”Ÿå‘½ä½“å¾åŸºæœ¬ç¨³å®šã€‚</span>';
    });
    el('#btnSleepAI').addEventListener('click', ()=>{
      const h = parseFloat(document.getElementById('sleepHour').value||7);
      const p = el('#sleepAIResult');
      p.classList.remove('hidden');
      p.innerHTML = (h<6? '<span class="text-amber-600">AIæç¤ºï¼šç¡çœ ä¸è¶³ï¼Œå»ºè®®ä¸‹åˆè®­ç»ƒå¼ºåº¦ä¸‹è°ƒã€‚</span>' : '<span class="text-green-600">AIæç¤ºï¼šç¡çœ è‰¯å¥½ï¼Œç»´æŒå½“å‰èŠ‚å¾‹ã€‚</span>');
    });
    el('#btnDietAI').addEventListener('click', ()=>{
      const p = el('#dietAIResult');
      p.classList.remove('hidden');
      p.innerHTML = '<span class="text-slate-700">AIæç¤ºï¼šè›‹ç™½è´¨é€‚ä¸­ï¼Œå»ºè®®å¢åŠ è”¬æœä¸è†³é£Ÿçº¤ç»´ä»¥ä¼˜åŒ–è¥å…»ç»“æ„ã€‚</span>';
    });

    // è§‚å¯Ÿï¼šå•é€‰åˆ‡æ¢æ˜¾ç¤ºå»ºè®®å›¾
    elAll('input[name="trainDaily"]').forEach(r=>r.addEventListener('change', ()=>{
      el('#trainSuggestImg').classList.toggle('hidden', r.value!=='å¦' || !r.checked);
    }));
    elAll('input[name="vital"]').forEach(r=>r.addEventListener('change', ()=>{
      el('#vitalSuggestImg').classList.toggle('hidden', r.value!=='å¦' || !r.checked);
    }));
    elAll('input[name="med"]').forEach(r=>r.addEventListener('change', ()=>{
      el('#medSuggestImg').classList.toggle('hidden', r.value!=='å¦' || !r.checked);
    }));
    elAll('input[name="diet"]').forEach(r=>r.addEventListener('change', ()=>{
      el('#dietSuggestImg').classList.toggle('hidden', r.value!=='å¦' || !r.checked);
    }));

    // ç©¿åˆºç‚¹ï¼šå¼‚å¸¸è”åŠ¨
    elAll('input[name="bleed"]').forEach(r=>r.addEventListener('change', ()=>{
      const isYes = r.value==='æ˜¯' && r.checked;
      el('#bleedTime').classList.toggle('hidden', !isYes);
      el('#bleedWarn').classList.toggle('hidden', !isYes);
    }));
    el('#skinTemp').addEventListener('input', (e)=>{
      const t = parseFloat(e.target.value);
      el('#tempWarn').classList.toggle('hidden', !(t && (t<32 || t>37.5)));
    });

    // éšè®¿è®°å½•
    el('#btnAddFollow').addEventListener('click', ()=>{
      const list = el('#followList');
      const time = el('#followTime').value || 'â€”';
      const text = el('#followText').value.trim();
      if(!text) return;
      const item = document.createElement('div');
      const date = new Date();
      const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')} ${time}`;
      item.className = 'flex items-start gap-2 py-1';
      item.innerHTML = `<div class="status-dot" style="background:#6366f1"></div><div><div class="text-xs text-slate-500">${dateStr}</div><div>${text}</div></div>`;
      list.prepend(item);
      el('#followText').value = '';
    });

    // æœç´¢è¿‡æ»¤
    el('#searchInput').addEventListener('input', (e)=>{
      renderTable(e.target.value.trim(), el('#filterType').value)
    });
    el('#filterType').addEventListener('change', (e)=>{
      renderTable(el('#searchInput').value.trim(), e.target.value)
    });

    // ç®€å•å¯¼èˆª
    el('#btnToOverview').onclick=()=>{
      el('#sectionOverview').classList.remove('hidden');
      el('#sectionPatients').classList.remove('hidden');
      el('#sectionDetail').classList.add('hidden');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    el('#btnToPatients').onclick=()=>{
      el('#sectionOverview').classList.add('hidden');
      el('#sectionPatients').classList.remove('hidden');
      el('#sectionDetail').classList.add('hidden');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    el('#btnBack').onclick=()=>{
      el('#btnToPatients').click();
    }

    // æ¨¡æ€æ¡†
    function openModal(html){
      el('#modalBody').innerHTML = html;
      el('#modal').classList.remove('hidden');
      el('#modal').classList.add('flex');
    }
    el('#modalClose').addEventListener('click', ()=>{
      el('#modal').classList.add('hidden');
      el('#modal').classList.remove('flex');
    });
    el('#modal').addEventListener('click', (e)=>{
      if(e.target.id==='modal') el('#modalClose').click();
    });

    // å¯åŠ¨æ¸²æŸ“
    renderDashboard();
    renderFocus();
    renderTable();
  </script>
</body>
</html>